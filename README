SCRATCHBOX 2 README

author: Lauri Leukkunen <lle@rahina.org>
date:   2007-07-02



LICENSING

All files are licensed under GNU LGPL version 2.1 unless specifically 
stated otherwise in the file itself.



GENERAL NOTICE

This is development code, it is broken. Don't expect to use it for
anything resembling production use. However, I firmly believe this is
infinitely more functional than Scratchbox 1.x can ever be.



INSTALLATION

You need git to work with sbox2, get it from http://git.or.cz/.

Clone the scratchbox 2 repository:

$ git clone git://anongit.freedesktop.org/git/sbox2


Build using:

$ cd sbox2
$ make install prefix=$HOME/scratchbox


You need Qemu for cpu-transparency. Current (2007-06-18) CVS version
of Qemu works fine, earlier versions lack the -drop-ld-preload option.

If you're targeting ARM and are on a 32bit x86 machine, you can get a 
good toolchain from CodeSourcery:

http://www.codesourcery.com/gnu_toolchains/arm/download.html


For amd64 systems there's a quite functional toolchain available here:

http://people.freedesktop.org/~lle/arm-lltc-gcc412-glibc25.tar.bz2

Add the compiler to your path before continuing, alternatively you can
give the absolute path to gcc in the sb2-init step below.

Now complete sb2 target setup:

$ mkdir $HOME/buildroot
$ cd $HOME/buildroot
$ $HOME/scratchbox/bin/sb2-init arm-none-linux-gnueabi-gcc

That will automatically generate a working sb2.config for the compiler
given on the command line.

At this point you can simply run sb2:

$ ../scratchbox/bin/sb2

To make sb2 default to the $HOME/buildroot sandbox, you can put this in
your $HOME/.sb2rc:
-- snip --
SBOX_TARGET_ROOT=~/buildroot
-- snip --

After that you can run sb2 from anywhere and it'll just do its magic.



MAEMO DEVELOPMENT

Download the latest rootstrap from:

http://repository.maemo.org/stable/3.1/armel/maemo-sdk-rootstrap_3.1_armel.tgz

Extract that to $HOME/buildroot

Edit $HOME/buildroot/etc/apt/apt.conf so that it looks like this:
-- snip --
APT {
Architecture armel;
}
-- snip --

Then build a proper libtool for your active toolchain by running 
this:

$ sb2 $HOME/scratchbox/bin/sb2-build-libtool

In order to build debian packages, you have to use -d switch for
dpkg-buildpackage to skip build dependency checking. A proper command line 
would be for example:

$ sb2 dpkg-buildpackage -rfakeroot -d

Full example of building fontconfig for Maemo would go like this:

$ sb2 apt-get source fontconfig
$ cd fontconfig-2.4.1
$ sb2 dpkg-buildpackage -rfakeroot -d

You don't need to be in $HOME/buildroot to do that, I typically do all
development work in $HOME/src.


That's all folks, enjoy!

